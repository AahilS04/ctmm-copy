<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dealing with telemetry error • ctmm</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Dealing with telemetry error">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ctmm</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/variogram.html">Variograms and Model Selection</a>
    </li>
    <li>
      <a href="../articles/akde.html">Autocorrelated Kernel Density Estimation</a>
    </li>
    <li>
      <a href="../articles/periodogram.html">Periodograms and Periodicities</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ctmm-initiative/ctmm">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Dealing with telemetry error</h1>
                        <h4 class="author">Christen H. Fleming</h4>
            
            <h4 class="date">2018-05-05</h4>
      
      <small>Source: <a href="https://github.com/ctmm-initiative/ctmm/blob/master/vignettes/error.Rmd"><code>vignettes/error.Rmd</code></a></small>
      <div class="hidden name"><code>error.Rmd</code></div>

    </div>

    
    
<div id="error-calibration" class="section level1">
<h1 class="hasAnchor">
<a href="#error-calibration" class="anchor"></a>Error calibration</h1>
<p>The first step to handling errors is to quantify them. Make sure that your data’s “dilution of precision” (DOP) and error columns import correctly into <code>ctmm</code>. Some tracking device manufacturers provide pre-calibrated errors. This fisher was tracked with an e-obs GPS collar that features calibrated errors for the location, imported by <code>ctmm</code> into the <code>VAR.xy</code> column, which represents the <code>x</code> and <code>y</code> error variances.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ctmm)
fisher &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.telemetry.html">as.telemetry</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>,<span class="st">"leroy.csv.gz"</span>,<span class="dt">package=</span><span class="st">"move"</span>))</code></pre></div>
<pre><code>## Warning in as.telemetry.data.frame(data, timeformat = timeformat, timezone
## = timezone, : VDOP not found. HDOP used as an approximate VDOP, which will
## require a separate UERE. See help("uere").</code></pre>
<pre><code>## Maximum speed of 1.05 m/s observed in Leroy</code></pre>
<pre><code>## Minimum sampling interval of 13.3 minutes in Leroy</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(fisher) <span class="co"># imported column names</span></code></pre></div>
<pre><code>##  [1] "timestamp" "longitude" "latitude"  "t"         "HDOP"     
##  [6] "VAR.xy"    "z"         "VDOP"      "speed"     "heading"  
## [11] "VAR.v"     "x"         "y"         "vx"        "vy"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot.telemetry.html">plot</a></span>(fisher,<span class="dt">error=</span><span class="dv">2</span>) <span class="co"># fisher plot with 95% error discs</span></code></pre></div>
<p><img src="error_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>Most GPS devices will only have an <code>HDOP</code> column, which is only proportional to the <code>x</code> and <code>y</code> error standard deviations. The proportionality constant between the HDOP and error standard deviation is known as the user equivalent range error (UERE). The UERE should be estimated from calibration data if not provided by the manufacturer. Without the option of pre-calibrated errors or calibration data, the UERE must be fit simultaneously with the movement model, which is not as reliable. We will cover simultaneous fitting at the end of this vignette.</p>
<p>In the following wood turtle dataset, we have some calibration data and a turtle track. Note that the calibration data must be collected from the same model device as the tracking data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ctmm)
<span class="kw">data</span>(turtle)
<span class="kw">names</span>(turtle)</code></pre></div>
<pre><code>## [1] "Calibration.1" "Calibration.2" "turtle"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot.telemetry.html">plot</a></span>(turtle[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>],<span class="dt">col=</span><span class="kw">rainbow</span>(<span class="dv">2</span>)) <span class="co"># calibration data only</span></code></pre></div>
<p><img src="error_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The <code>uere</code> command is used to estimate the UERE parameter from calibration data. Do not use this command on animal tracking data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UERE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/uere.html">uere</a></span>(turtle[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]) <span class="co"># only using calibration data</span>
UERE</code></pre></div>
<pre><code>## horizontal 
##   10.62713</code></pre>
<p>For GPS data, the UERE will typically be 10-15 meters. The UERE can be assigned to a dataset with the <code>uere&lt;-</code> command.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/uere.html">uere</a></span>(turtle) &lt;-<span class="st"> </span>UERE
<span class="kw"><a href="../reference/plot.telemetry.html">plot</a></span>(turtle[[<span class="dv">3</span>]],<span class="dt">error=</span><span class="dv">2</span>) <span class="co"># turtle plot with 95% error discs</span></code></pre></div>
<p><img src="error_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="outlier-detection" class="section level1">
<h1 class="hasAnchor">
<a href="#outlier-detection" class="anchor"></a>Outlier detection</h1>
<p>Now we come to the task of identifying outliers. The <code>outlie</code> function uses error information to estimate straight-line speeds between sampled times and distances from the bulk of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/outlie.html">outlie</a></span>(turtle[[<span class="dv">3</span>]]) -&gt;<span class="st"> </span>OUT</code></pre></div>
<p><img src="error_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>High-speed segments are colored in blue, while distant locations are colored in red. More emphasis is placed on the more extreme locations in the <code>outlie</code> plot. Visually we can see at least one outlier in the wood turtle data. The output of <code>outlie</code> also contains the error-informed speed and distance estimates (in SI units) used to generate the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot.telemetry.html">plot</a></span>(OUT)</code></pre></div>
<p><img src="error_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>A sustained speed of 0.1 m/s is not biologically implausible for a wood turtle, but this location is highly suspicious. After removing the outlier, we can check the data again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BAD &lt;-<span class="st"> </span><span class="kw">which.max</span>(OUT<span class="op">$</span>speed)
turtle[[<span class="dv">3</span>]] &lt;-<span class="st"> </span>turtle[[<span class="dv">3</span>]][<span class="op">-</span>BAD,]
<span class="kw"><a href="../reference/outlie.html">outlie</a></span>(turtle[[<span class="dv">3</span>]]) -&gt;<span class="st"> </span>OUT</code></pre></div>
<p><img src="error_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Datasets may have multiple outliers. In pathological situations, there may be no clear separation between the normative data and the outliers. This necessitates a better error model, either by improving inadequate (or absent) HDOP estimates or by employing a heavier tailed error distribution (not yet supported).</p>
</div>
<div id="variograms-and-model-selection" class="section level1">
<h1 class="hasAnchor">
<a href="#variograms-and-model-selection" class="anchor"></a>Variograms and model selection</h1>
<div id="variograms" class="section level2">
<h2 class="hasAnchor">
<a href="#variograms" class="anchor"></a>Variograms</h2>
<p>If we were working with ARGOS data or high resolution GPS data on a small animal, then we can get a “nugget” effect in the variogram that looks like an initial discontinuity at short time lags.</p>
<p><img src="error_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="error_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<p>The height of this initial discontinuity corresponds to the variance of uncorrelated location errors. The second plot is the kind of initial discontinuity one has with detector array data. The end of the (slope) discontinuity is highlighted with a circle. This discontinuity is smooth because the movement and detection are correlated. The height of this initial discontinuity is also (at least roughly) the variance of the location errors.</p>
</div>
<div id="model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting" class="anchor"></a>Model fitting</h2>
<p>Because of some convenient mathematical relations, fitting with telemetry errors involves numerically fitting 1-4 more parameters and is, therefore, slower and less reliable at converging on the MLE than fitting without telemetry error. By default, telemetry error is not turned on in <code>ctmm</code> models (<code>error=FALSE</code>). For calibrated errors, we have to set <code>error=TRUE</code> in the model guess to fit with telemetry error accounted for. For uncalibrated errors, we have to provide an initial guess for <code>error</code>, which will be the device’s UERE. <code>error=10</code> is usually a good guess for GPS data.</p>
<div id="fitting-with-small-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-with-small-errors" class="anchor"></a>Fitting with small errors</h3>
<p>When telemetry errors are relatively small compared to the scale of movement over the sampled time intervals, we can first fit a model without error and use this fit as an initial guess for fitting a model with error. Here we demonstrate this method with Leroy the fisher.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ctmm beta optimizer is more reliable here</span>
<span class="co"># control &lt;- list(method='pNewton',cores=-1) # use all but 1 core</span>
control &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">method=</span><span class="st">'pNewton'</span>,<span class="dt">cores=</span><span class="dv">2</span>) <span class="co"># CRAN policy limits us to 2 processes</span>

<span class="co"># default model guess without error</span>
GUESS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variogram.fit.html">ctmm.guess</a></span>(fisher,<span class="dt">interactive=</span><span class="ot">FALSE</span>)
<span class="co"># first fit without telemetry error</span>
FIT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span>(fisher,GUESS,<span class="dt">control=</span>control)
<span class="kw">summary</span>(FIT)</code></pre></div>
<pre><code>## $DOF
##     mean     area 
## 15.74707 28.38280 
## 
## $CI
##                               low       ML     high
## area (square kilometers) 32.95717 49.44648 69.22745
## tau position (hours)     10.12899 16.43811 26.67703
## tau velocity (minutes)   10.50828 11.97002 13.63509
## speed (kilometers/day)   29.60930 30.62564 31.64153</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># second fit based on first, but with telemetry error activated</span>
GUESS &lt;-<span class="st"> </span>FIT
GUESS<span class="op">$</span>error &lt;-<span class="st"> </span><span class="ot">TRUE</span>
FIT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span>(fisher,GUESS,<span class="dt">control=</span>control)
<span class="kw">summary</span>(FIT)</code></pre></div>
<pre><code>## $DOF
##     mean     area 
## 16.61247 29.61526 
## 
## $CI
##                                low       ML     high
## area (square kilometers) 32.778869 48.71955 67.76886
## tau position (hours)      9.603142 15.45319 24.86697
## tau velocity (minutes)   11.781377 13.47104 15.40303
## speed (kilometers/day)   28.583662 29.61325 30.64235</code></pre>
</div>
<div id="fitting-with-large-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-with-large-errors" class="anchor"></a>Fitting with large errors</h3>
<p>When telemetry errors are relatively large, we might fit an isotropic (circular) model first and then use that fit to construct an initial guess for an anisotropic (elliptical) model. Here we demonstrate this method with a wood turtle.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># automated guestimates with circular covariance and calibrated errors</span>
GUESS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variogram.fit.html">ctmm.guess</a></span>(turtle[[<span class="dv">3</span>]],<span class="dt">CTMM=</span><span class="kw"><a href="../reference/ctmm.fit.html">ctmm</a></span>(<span class="dt">error=</span><span class="ot">TRUE</span>,<span class="dt">isotropic=</span><span class="ot">TRUE</span>),<span class="dt">interactive=</span><span class="ot">FALSE</span>)
<span class="co"># first fit circular model</span>
FIT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span>(turtle[[<span class="dv">3</span>]],GUESS,<span class="dt">control=</span>control)
<span class="kw">summary</span>(FIT)</code></pre></div>
<pre><code>## $DOF
##     mean     area 
## 11.02207 21.75032 
## 
## $CI
##                               low         ML      high
## area (hectares)         20.994061  33.600052  49.12255
## tau position (days)      4.020575   7.298895  13.25031
## tau velocity (minutes)   0.000000  33.520592  91.58042
## speed (meters/day)     118.899657 458.395539 814.35946</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create elliptical model guess</span>
GUESS &lt;-<span class="st"> </span>FIT
GUESS<span class="op">$</span>isotropic &lt;-<span class="st"> </span><span class="ot">FALSE</span>
<span class="co"># populate eccentricity and orientation with guesstimates</span>
GUESS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variogram.fit.html">ctmm.guess</a></span>(turtle[[<span class="dv">3</span>]],<span class="dt">CTMM=</span>GUESS,<span class="dt">interactive=</span><span class="ot">FALSE</span>)
<span class="co"># second fit elliptical model</span>
FIT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span>(turtle[[<span class="dv">3</span>]],GUESS,<span class="dt">control=</span>control)
<span class="co"># velocity does not appear supported</span>
<span class="kw">summary</span>(FIT)</code></pre></div>
<pre><code>## $DOF
##     mean     area 
## 13.04392 25.20268 
## 
## $CI
##                              low         ML       high
## area (hectares)        12.272166  18.926628   26.99955
## tau position (days)     3.482668   6.068068   10.57277
## tau velocity (minutes)  0.000000  24.001766   90.70231
## speed (meters/day)     22.733265 541.524021 1188.56293</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># proceed with model selection</span>
FIT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ctmm.fit.html">ctmm.select</a></span>(turtle[[<span class="dv">3</span>]],FIT,<span class="dt">control=</span>control)
<span class="co"># velocity was not supported by this data</span>
<span class="kw">summary</span>(FIT)</code></pre></div>
<pre><code>## $DOF
##     mean     area 
## 12.60023 24.41847 
## 
## $CI
##                          low        ML     high
## area (hectares)     12.19313 18.949535 27.17159
## tau position (days)  3.69292  6.318502 10.81081</code></pre>
<p>Note also that we performed model selection with a fit (which would then be re-fit) as our initial guess, rather than the raw guess output of <code>ctmm.guess</code> or <code>variogram.fit</code>. This helps ensure convergence in the optimizer.</p>
</div>
<div id="fitting-with-unknown-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-with-unknown-errors" class="anchor"></a>Fitting with unknown errors</h3>
<p>Fitting with unknown errors is a method of last resort. Let’s consider the turtle data again, but without calibrated UERE.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># delete UERE information</span>
<span class="kw"><a href="../reference/uere.html">uere</a></span>(turtle[[<span class="dv">3</span>]]) &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p>The only difference is that you have to provide an initial guess for the UERE. Otherwise, the steps are the same.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># cheat and use previous fit as initial guess</span>
GUESS &lt;-<span class="st"> </span>FIT
GUESS<span class="op">$</span>error &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co"># 10 meter error guess</span>
<span class="co"># fit parameter estimates</span>
FIT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span>(turtle[[<span class="dv">3</span>]],GUESS,<span class="dt">control=</span>control)
<span class="kw">summary</span>(FIT)</code></pre></div>
<pre><code>## $DOF
##     mean     area 
## 13.46154 25.98200 
## 
## $CI
##                           low        ML      high
## area (hectares)     12.604532 19.298760 27.396082
## tau position (days)  3.467314  5.882922  9.981435
## error (meters)       7.804840  9.317615 10.827626</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#error-calibration">Error calibration</a></li>
      <li><a href="#outlier-detection">Outlier detection</a></li>
      <li>
<a href="#variograms-and-model-selection">Variograms and model selection</a><ul class="nav nav-pills nav-stacked">
<li><a href="#variograms">Variograms</a></li>
      <li><a href="#model-fitting">Model fitting</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Christen H. Fleming, Justin M. Calabrese.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
